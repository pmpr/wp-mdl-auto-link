<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             689b491540fea             |
    |_______________________________________|
*/
 namespace Pmpr\Module\AutoLink; use DOMElement; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Module\AutoLink\Model\ContentSegment; use Pmpr\Module\AutoLink\Model\PhraseDictionary; use Pmpr\Module\AutoLink\Model\PhraseMatch; use Pmpr\Module\AutoLink\Model\SiteContent; class Engine extends Container { public function swwkwyegmykkcccc() { $sciomagaqmgggsiu = []; $acqqmqmcquukaqsc = $this->uosumyqkueiykgiu(); foreach ($acqqmqmcquukaqsc as $ekuqiqmikiicgoss) { $ewaokemkkcawgmam = $ekuqiqmikiicgoss[Setting::ssueywueuqgowsee] ?? []; if ($ewaokemkkcawgmam) { foreach ($ewaokemkkcawgmam as $dacakmaeokqmmeqa) { if (!in_array($dacakmaeokqmmeqa, $sciomagaqmgggsiu, true)) { $sciomagaqmgggsiu[] = $dacakmaeokqmmeqa; } } } } if ($sciomagaqmgggsiu) { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $ummomuiskoeiqaik = SiteContent::symcgieuakksimmu(); $ceiwsaacewygcsqg = $ummomuiskoeiqaik->kumuygiiqswoyasy(); $gqgemcmoicmgaqie = $eqwoegegiamegqsm->kyckwuuiqwmyoqma()->omaeiiwasuqkeeak($ummomuiskoeiqaik->myywwqkyiwawwquy($ceiwsaacewygcsqg))->omaeiiwasuqkeeak('posts.ID as post_id')->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->owackeyiuiikegqg(Constants::eggygikowgywcayq, 'ID')->aqkyoweegqwuwsgw(Constants::qgmuskygocwmouos)->gmaouawykqgywcme())->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::gikuasuikwemyqoq, Constants::wmmucsiyiyusmssm)->aqkyoweegqwuwsgw(Constants::qgmuskygocwmouos))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::isukysauqkiecswi, '0')->aqkyoweegqwuwsgw(Constants::qgmuskygocwmouos))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::uouymeyqasaeckso, $sciomagaqmgggsiu)->gouskoeouiqwokqs()->aqkyoweegqwuwsgw(Constants::qgmuskygocwmouos))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim($ceiwsaacewygcsqg)->wegeyaguowmkqiac()); $siykeiywomwwuoiw = $ummomuiskoeiqaik->iekyeyicoyyawomk()->kqewyqqqiyiouaou($gqgemcmoicmgaqie); $sogksuscggsicmac = $ummomuiskoeiqaik->iekyeyicoyyawomk()->aeggeuqycwawueqy($siykeiywomwwuoiw, [Constants::ausqeuugegoygouq => 20, Constants::imywcsggckkcywgk => 1]); $oammesyieqmwuwyi = $sogksuscggsicmac[Constants::qwumqqyuasyskkkc]; if ($oammesyieqmwuwyi) { foreach ($oammesyieqmwuwyi as $igqsaukqcqscimok) { $gcqseksiskwueksc = $ummomuiskoeiqaik->waecsyqmwascmqoa($igqsaukqcqscimok, Constants::kqigmeickowqiiyy); $this->imimyeookyaksoyo($gcqseksiskwueksc, Constants::mswoacegomcucaik); } } if (!$this->caokeucsksukesyo()->asgqmkcukouykiie()->iyiccksyewqymmqg($sogksuscggsicmac, 1)) { Process::symcgieuakksimmu()->awuyugqcgwuqqqou(); } } } public function imimyeookyaksoyo($moqewomugocaueis, $mqyaskyaekmkegmg) { if (empty($moqewomugocaueis) || empty($mqyaskyaekmkegmg)) { return; } $meqocwsecsywiiqs = $yuucaqagmqisqyas = $sqeykgyoooqysmca = null; switch ($mqyaskyaekmkegmg) { case Constants::mswoacegomcucaik: $seumokooiykcomco = $this->caokeucsksukesyo()->ayueggmoqeeukqmq(); if ($post = $seumokooiykcomco->get($moqewomugocaueis, Constants::ckmqoekmugkggeym, true)) { $sqeykgyoooqysmca = $seumokooiykcomco->gueasuouwqysmomu($post); $meqocwsecsywiiqs = $seumokooiykcomco->qcgakseyaikigqco($post); $yuucaqagmqisqyas = $seumokooiykcomco->wykuawssiegcmeso($moqewomugocaueis); } break; case Constants::yoayaissyomokiui: $aoskwucuugeuaeus = $this->caokeucsksukesyo()->kckogqkiycqeumoa(); if ($iwewcwusemqaiggk = $aoskwucuugeuaeus->get($moqewomugocaueis)) { $sqeykgyoooqysmca = $aoskwucuugeuaeus->yyoeeseewqmmyaee($iwewcwusemqaiggk); $meqocwsecsywiiqs = $aoskwucuugeuaeus->qcgakseyaikigqco($iwewcwusemqaiggk); } break; } $meqocwsecsywiiqs = $this->suaeuucwwgumucek($meqocwsecsywiiqs, false); $yuucaqagmqisqyas = $this->suaeuucwwgumucek($yuucaqagmqisqyas, false); if ($sqeykgyoooqysmca && ($meqocwsecsywiiqs || $yuucaqagmqisqyas)) { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $ummomuiskoeiqaik = SiteContent::symcgieuakksimmu(); $cmaccwokqweqweqi = $ummomuiskoeiqaik->iekyeyicoyyawomk()->oqomcmyuuakigusk($eqwoegegiamegqsm->gwumowwouoisykio([Constants::eggygikowgywcayq => $moqewomugocaueis, Constants::wwcycgyaiaksckuk => $mqyaskyaekmkegmg])); $mmsmqmyymgwqqweo = 0; if (empty($cmaccwokqweqweqi)) { $sogksuscggsicmac = $ummomuiskoeiqaik->gssiscqyqsacmeca()->gsegsiocqmsoayii([Constants::squoamkioomemiyi => $sqeykgyoooqysmca, Constants::qescuiwgsyuikume => $meqocwsecsywiiqs, Constants::usaygycaymimogmw => $yuucaqagmqisqyas, Constants::eggygikowgywcayq => $moqewomugocaueis, Constants::wwcycgyaiaksckuk => $mqyaskyaekmkegmg]); if (!is_wp_error($sogksuscggsicmac)) { $mmsmqmyymgwqqweo = $sogksuscggsicmac[Constants::gouqcwikiiygyasc]; } } else { $mmsmqmyymgwqqweo = $ummomuiskoeiqaik->mwyqswsaeeewsosm($cmaccwokqweqweqi); $eouyueoqokecawsw = [Constants::squoamkioomemiyi => $sqeykgyoooqysmca, Constants::qescuiwgsyuikume => $meqocwsecsywiiqs, Constants::usaygycaymimogmw => $yuucaqagmqisqyas]; foreach ($eouyueoqokecawsw as $uusmaiomayssaecw => $cusosqmyoqiykqgw) { if ($cusosqmyoqiykqgw !== $ummomuiskoeiqaik->waecsyqmwascmqoa($cmaccwokqweqweqi, $uusmaiomayssaecw)) { $eouyueoqokecawsw[$uusmaiomayssaecw] = $cusosqmyoqiykqgw; } else { unset($eouyueoqokecawsw[$uusmaiomayssaecw]); } } if ($eouyueoqokecawsw) { $ummomuiskoeiqaik->gssiscqyqsacmeca()->wqikesawekycweoi($cmaccwokqweqweqi, $eouyueoqokecawsw, true); } } if ($mmsmqmyymgwqqweo) { $this->yuemssockemkksug($mmsmqmyymgwqqweo, $moqewomugocaueis, $mqyaskyaekmkegmg); Process::symcgieuakksimmu()->mkisoggamickeicw($mmsmqmyymgwqqweo, 1); } } } public function yuemssockemkksug($mmsmqmyymgwqqweo, $moqewomugocaueis, $mqyaskyaekmkegmg) { $ewgwqamkygiqaawc = ''; switch ($mqyaskyaekmkegmg) { case Constants::mswoacegomcucaik: $ewgwqamkygiqaawc = $this->caokeucsksukesyo()->ayueggmoqeeukqmq()->souwykwwmyygqyqi($moqewomugocaueis, false); break; case Constants::yoayaissyomokiui: $ewgwqamkygiqaawc = $this->uwkmaywceaaaigwo()->kckogqkiycqeumoa()->meqceykmywmqgoym($moqewomugocaueis); break; } if ($ewgwqamkygiqaawc) { $smuykqsageuocuos = $this->caokeucsksukesyo()->gkksucgseqqemesc(); if ($smuykqsageuocuos->has($ewgwqamkygiqaawc, 'strong, h2')) { $goiaaeekgeqqmaqo = $smuykqsageuocuos->qaqiuweqoukkgqsk($ewgwqamkygiqaawc, 'h2:not([data-identify]), strong:not([data-identify])', function (DOMElement $ymyisaeksssueeik) use($smuykqsageuocuos) { $owqaeesoaygymmcy = $this->caokeucsksukesyo()->owgcciayoweymuws()->gykqksiwukaccoyg(ContentSegment::aiyuksmkquggmyqs); $smuykqsageuocuos->uysisegumsawmycq($ymyisaeksssueeik, 'data-identify', $owqaeesoaygymmcy); return $ymyisaeksssueeik; }); if ($goiaaeekgeqqmaqo && $ewgwqamkygiqaawc !== $goiaaeekgeqqmaqo) { $ewgwqamkygiqaawc = $goiaaeekgeqqmaqo; switch ($mqyaskyaekmkegmg) { case Constants::mswoacegomcucaik: $this->caokeucsksukesyo()->ayueggmoqeeukqmq()->update($moqewomugocaueis, [Constants::egkuckyqcaygmymg => $ewgwqamkygiqaawc]); break; case Constants::yoayaissyomokiui: $this->caokeucsksukesyo()->kckogqkiycqeumoa()->update($moqewomugocaueis, [Constants::egkuckyqcaygmymg => $ewgwqamkygiqaawc]); break; } } preg_match_all('/(<h2.*?>.*?<\\/h2>)/s', $ewgwqamkygiqaawc, $ymcousskmscsyees, PREG_OFFSET_CAPTURE); if (!empty($ymcousskmscsyees[0])) { $mgiqqesweuqmsymo = []; if (isset($ymcousskmscsyees[0][0][1]) && $ymcousskmscsyees[0][0][1] > 0) { $mgiqqesweuqmsymo[] = substr($ewgwqamkygiqaawc, 0, $ymcousskmscsyees[0][0][1]); } foreach ($ymcousskmscsyees[0] as $momcykaoccoymeig => $iuimqckcgwwkgygo) { $ggkaciewmeqmgckg = $iuimqckcgwwkgygo[1]; $qmeuaeiseuacgiqc = isset($ymcousskmscsyees[0][$momcykaoccoymeig + 1]) ? $ymcousskmscsyees[0][$momcykaoccoymeig + 1][1] : strlen($ewgwqamkygiqaawc); $mgiqqesweuqmsymo[] = substr($ewgwqamkygiqaawc, $ggkaciewmeqmgckg, $qmeuaeiseuacgiqc - $ggkaciewmeqmgckg); } foreach ($mgiqqesweuqmsymo as $osykqueyuiqkukcw) { $eimoeiuiokiukeqi = null; $uakqkemgwcguemgi = $smuykqsageuocuos->wugqmqwisygwoeas($osykqueyuiqkukcw, 'h2'); if ($uakqkemgwcguemgi) { $owqaeesoaygymmcy = $smuykqsageuocuos->guaqqcyuaeucmgoy($uakqkemgwcguemgi, 'data-identify'); $wgkisieqccekcwya = $smuykqsageuocuos->skciuoqgiqoawwwe($uakqkemgwcguemgi, true); $eimoeiuiokiukeqi = $this->iiswmuskaaimqkmo($wgkisieqccekcwya, $owqaeesoaygymmcy, ContentSegment::cqqgeyyqiugckwgw, $mmsmqmyymgwqqweo); } $smuykqsageuocuos->qaqiuweqoukkgqsk($osykqueyuiqkukcw, 'strong', function (DOMElement $ymyisaeksssueeik) use($smuykqsageuocuos, $eimoeiuiokiukeqi, $mmsmqmyymgwqqweo) { $owqaeesoaygymmcy = $smuykqsageuocuos->guaqqcyuaeucmgoy($ymyisaeksssueeik, 'data-identify'); $qcqouasmmaumioew = $smuykqsageuocuos->skciuoqgiqoawwwe($ymyisaeksssueeik, true); $this->iiswmuskaaimqkmo($qcqouasmmaumioew, $owqaeesoaygymmcy, ContentSegment::yawkygsammoiwywe, $mmsmqmyymgwqqweo, $eimoeiuiokiukeqi); return $ymyisaeksssueeik; }, 0, false); } } } } } public function iiswmuskaaimqkmo($somkywoaqsaocseu, $owqaeesoaygymmcy, $sqeykgyoooqysmca, $mmsmqmyymgwqqweo, $gqumacwamusueoqa = null) { $somkywoaqsaocseu = $this->suaeuucwwgumucek($somkywoaqsaocseu); if (empty($somkywoaqsaocseu) || empty($owqaeesoaygymmcy) || empty($sqeykgyoooqysmca) || empty($mmsmqmyymgwqqweo)) { return false; } $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $mgsymeokaoqggkcm = ContentSegment::symcgieuakksimmu(); $gqgemcmoicmgaqie = $eqwoegegiamegqsm->kyckwuuiqwmyoqma()->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::squoamkioomemiyi, $sqeykgyoooqysmca))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::IDENTIFIER, $owqaeesoaygymmcy))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim($mgsymeokaoqggkcm::cscaseoccsekwyms, $mmsmqmyymgwqqweo)); if ($gqumacwamusueoqa) { $gqgemcmoicmgaqie->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim($mgsymeokaoqggkcm::umyomemqwccgmuki, $gqumacwamusueoqa)); } else { $gqgemcmoicmgaqie->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim($mgsymeokaoqggkcm::umyomemqwccgmuki)->wegeyaguowmkqiac()); } $ckkiimuqcimkwmwy = $mgsymeokaoqggkcm->iekyeyicoyyawomk()->oqomcmyuuakigusk($gqgemcmoicmgaqie); $iumiycweoqayuegw = PhraseDictionary::symcgieuakksimmu(); $uoskqyimwccsuakg = 0; $dssykqqaucioksgm = $iumiycweoqayuegw->iekyeyicoyyawomk()->akkkoiiymmamsauc($somkywoaqsaocseu, Constants::TEXT); if (!$dssykqqaucioksgm) { $mksmeccucmqgekis = $iumiycweoqayuegw->gssiscqyqsacmeca()->gsegsiocqmsoayii([Constants::TEXT => $somkywoaqsaocseu], true); if (!is_wp_error($mksmeccucmqgekis)) { $uoskqyimwccsuakg = $mksmeccucmqgekis[Constants::gouqcwikiiygyasc]; } } else { $uoskqyimwccsuakg = $iumiycweoqayuegw->mwyqswsaeeewsosm($dssykqqaucioksgm); } $aokagokqyuysuksm = $ckkiimuqcimkwmwy ? $mgsymeokaoqggkcm->mwyqswsaeeewsosm($ckkiimuqcimkwmwy) : 0; if (empty($ckkiimuqcimkwmwy)) { $cyeaaouwgsseiqsy = $mgsymeokaoqggkcm->gssiscqyqsacmeca()->gsegsiocqmsoayii([Constants::squoamkioomemiyi => $sqeykgyoooqysmca, Constants::ciywsqoeiymemsys => Constants::sgoswgskyiiwkyuo, Constants::IDENTIFIER => $owqaeesoaygymmcy, $mgsymeokaoqggkcm::umyomemqwccgmuki => $gqumacwamusueoqa, $mgsymeokaoqggkcm::cscaseoccsekwyms => $mmsmqmyymgwqqweo, $mgsymeokaoqggkcm::yuokwskigygossmk => $uoskqyimwccsuakg]); if (!is_wp_error($cyeaaouwgsseiqsy)) { $aokagokqyuysuksm = $cyeaaouwgsseiqsy[Constants::gouqcwikiiygyasc]; } } else { if ($uoskqyimwccsuakg !== $mgsymeokaoqggkcm->waecsyqmwascmqoa($ckkiimuqcimkwmwy, $mgsymeokaoqggkcm::yuokwskigygossmk)) { $mgsymeokaoqggkcm->gssiscqyqsacmeca()->wqikesawekycweoi($ckkiimuqcimkwmwy, [$mgsymeokaoqggkcm::umyomemqwccgmuki => $gqumacwamusueoqa, $mgsymeokaoqggkcm::yuokwskigygossmk => $uoskqyimwccsuakg]); $aokagokqyuysuksm = $mgsymeokaoqggkcm->mwyqswsaeeewsosm($ckkiimuqcimkwmwy); } } return $aokagokqyuysuksm; } public function iqykecccmksseywo($guqoesoiwwsmecuu, ?string $mqyaskyaekmkegmg = null) { $dacakmaeokqmmeqa = null; $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $ummomuiskoeiqaik = SiteContent::symcgieuakksimmu(); if (!empty($mqyaskyaekmkegmg)) { if (is_numeric($guqoesoiwwsmecuu)) { $dacakmaeokqmmeqa = $ummomuiskoeiqaik->iekyeyicoyyawomk()->oqomcmyuuakigusk([$eqwoegegiamegqsm->megqywqeuquawkim(Constants::wwcycgyaiaksckuk, $mqyaskyaekmkegmg), $eqwoegegiamegqsm->megqywqeuquawkim(Constants::eggygikowgywcayq, $guqoesoiwwsmecuu)]); } else { } } else { if (is_numeric($guqoesoiwwsmecuu)) { $dacakmaeokqmmeqa = $ummomuiskoeiqaik->iekyeyicoyyawomk()->akkkoiiymmamsauc($guqoesoiwwsmecuu); } else { if (is_object($guqoesoiwwsmecuu) || is_array($guqoesoiwwsmecuu)) { $dacakmaeokqmmeqa = $guqoesoiwwsmecuu; } } } return $dacakmaeokqmmeqa; } public function ammmmcskmmswueqe($guqoesoiwwsmecuu, ?string $mqyaskyaekmkegmg = null) { $dacakmaeokqmmeqa = $this->iqykecccmksseywo($guqoesoiwwsmecuu, $mqyaskyaekmkegmg); if ($dacakmaeokqmmeqa) { $ummomuiskoeiqaik = SiteContent::symcgieuakksimmu(); $moqewomugocaueis = $ummomuiskoeiqaik->waecsyqmwascmqoa($dacakmaeokqmmeqa, Constants::eggygikowgywcayq); $mqyaskyaekmkegmg = $ummomuiskoeiqaik->ogegcqqcukiaqscy(Constants::squoamkioomemiyi, $dacakmaeokqmmeqa); $ewgwqamkygiqaawc = ''; switch ($mqyaskyaekmkegmg) { case Constants::mswoacegomcucaik: $ewgwqamkygiqaawc = $this->caokeucsksukesyo()->ayueggmoqeeukqmq()->souwykwwmyygqyqi($moqewomugocaueis); break; case Constants::yoayaissyomokiui: $ewgwqamkygiqaawc = $this->uwkmaywceaaaigwo()->kckogqkiycqeumoa()->meqceykmywmqgoym($moqewomugocaueis); break; } if ($ewgwqamkygiqaawc) { $mgsymeokaoqggkcm = ContentSegment::symcgieuakksimmu(); $kwyycckiamksuewc = $mgsymeokaoqggkcm->iekyeyicoyyawomk()->cieaqygkucwoqwke([$mgsymeokaoqggkcm::cscaseoccsekwyms => $ummomuiskoeiqaik->mwyqswsaeeewsosm($dacakmaeokqmmeqa)]); $smuykqsageuocuos = $this->caokeucsksukesyo()->gkksucgseqqemesc(); foreach ($kwyycckiamksuewc as $ckkiimuqcimkwmwy) { $scwiymciagumsuiw = $mgsymeokaoqggkcm->ogegcqqcukiaqscy(Constants::squoamkioomemiyi, $ckkiimuqcimkwmwy) === $mgsymeokaoqggkcm::yawkygsammoiwywe ? 'strong' : 'h2'; $owqaeesoaygymmcy = $mgsymeokaoqggkcm->waecsyqmwascmqoa($ckkiimuqcimkwmwy, Constants::IDENTIFIER); if ($smuykqsageuocuos->has($ewgwqamkygiqaawc, "{$scwiymciagumsuiw}[{$owqaeesoaygymmcy}]")) { $mgsymeokaoqggkcm->gssiscqyqsacmeca()->sgcuwcowgwimgsgk($mgsymeokaoqggkcm->mwyqswsaeeewsosm($ckkiimuqcimkwmwy), true); } } } } } public function cysqwocigwyquqas($mmsmqmyymgwqqweo, $suaemuyiacqyugsm, bool $goyamqigsmqwymmg = false) { if ($dacakmaeokqmmeqa = $this->iqykecccmksseywo($mmsmqmyymgwqqweo)) { $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $ummomuiskoeiqaik = SiteContent::symcgieuakksimmu(); $mgigqqaeseywokym = PhraseMatch::symcgieuakksimmu(); $mgsymeokaoqggkcm = ContentSegment::symcgieuakksimmu(); $iumiycweoqayuegw = PhraseDictionary::symcgieuakksimmu(); $sqeykgyoooqysmca = $ummomuiskoeiqaik->waecsyqmwascmqoa($dacakmaeokqmmeqa, Constants::squoamkioomemiyi); $acqqmqmcquukaqsc = $this->uosumyqkueiykgiu(Setting::iumakqycmqmikeiq, $sqeykgyoooqysmca, true); if ($acqqmqmcquukaqsc) { $mmsmqmyymgwqqweo = $ummomuiskoeiqaik->mwyqswsaeeewsosm($dacakmaeokqmmeqa); $gcsemeqqqcoqeooa = $iumiycweoqayuegw->iekyeyicoyyawomk(); $gqgemcmoicmgaqie = $eqwoegegiamegqsm->kyckwuuiqwmyoqma()->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->owackeyiuiikegqg()->ggmcoioqwgyccyus()->sokmmiiuyqiuoqia($iumiycweoqayuegw::igsgqsyawmiwquqa))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->owackeyiuiikegqg()->ggmcoioqwgyccyus()->sokmmiiuyqiuoqia($iumiycweoqayuegw::iwcwgauyguemyacm))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim($mgsymeokaoqggkcm::cscaseoccsekwyms, $mmsmqmyymgwqqweo)->asumqyigwsqmyeoc($mgsymeokaoqggkcm))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::squoamkioomemiyi, array_keys($acqqmqmcquukaqsc))->asumqyigwsqmyeoc($mgsymeokaoqggkcm))->yockscoguugkeumq([$iumiycweoqayuegw->kumuygiiqswoyasy(true), $iumiycweoqayuegw->myywwqkyiwawwquy(Constants::TEXT), $mgsymeokaoqggkcm->myywwqkyiwawwquy(Constants::squoamkioomemiyi)])->omaeiiwasuqkeeak($iumiycweoqayuegw->kumuygiiqswoyasy(true))->omaeiiwasuqkeeak($iumiycweoqayuegw->myywwqkyiwawwquy(Constants::TEXT))->omaeiiwasuqkeeak($mgsymeokaoqggkcm->myywwqkyiwawwquy(Constants::squoamkioomemiyi)); $siykeiywomwwuoiw = $gcsemeqqqcoqeooa->kqewyqqqiyiouaou($gqgemcmoicmgaqie); $sogksuscggsicmac = $gcsemeqqqcoqeooa->aeggeuqycwawueqy($siykeiywomwwuoiw, [Constants::ausqeuugegoygouq => 20, Constants::imywcsggckkcywgk => $suaemuyiacqyugsm]); $esmaqoikwysmecmu = $sogksuscggsicmac[Constants::qwumqqyuasyskkkc] ?? []; if ($esmaqoikwysmecmu) { $igkeeiamaoykccmq = $this->weysguygiseoukqw(Setting::kywcqmcceiaqkuqq, Constants::qescuiwgsyuikume); $qgowgcsuycquswmo = [ "0.4 * (1 - LEAST(LEVENSHTEIN_SCORE('%1\$s', %2\$s) / 100, 1))", "0.6 * JACCARD_SIMILARITY('%1\$s', %2\$s)", ]; $cqymoigcsuqqwuki = $ummomuiskoeiqaik->iekyeyicoyyawomk(); foreach ($esmaqoikwysmecmu as $icswuaiqeooqqeqc) { $sqeykgyoooqysmca = $mgsymeokaoqggkcm->ogegcqqcukiaqscy(Constants::squoamkioomemiyi, $icswuaiqeooqqeqc, $mgsymeokaoqggkcm::yawkygsammoiwywe); $ekuqiqmikiicgoss = $acqqmqmcquukaqsc[$sqeykgyoooqysmca] ?? false; if ($ekuqiqmikiicgoss) { $somkywoaqsaocseu = $iumiycweoqayuegw->waecsyqmwascmqoa($icswuaiqeooqqeqc, Constants::TEXT, ''); $ewaokemkkcawgmam = $ekuqiqmikiicgoss[Setting::ssueywueuqgowsee] ?? []; $qmimsiuoiwuuuscy = '(' . sprintf(implode('+', $qgowgcsuycquswmo), esc_sql($somkywoaqsaocseu), $igkeeiamaoykccmq) . ')'; $ukewoymaumsmmswq = $eqwoegegiamegqsm->kyckwuuiqwmyoqma()->omaeiiwasuqkeeak($mgsymeokaoqggkcm->kumuygiiqswoyasy())->omaeiiwasuqkeeak(Constants::qescuiwgsyuikume)->omaeiiwasuqkeeak("{$qmimsiuoiwuuuscy} AS similarity", true)->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim(Constants::squoamkioomemiyi, $ewaokemkkcawgmam))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim($igkeeiamaoykccmq, $somkywoaqsaocseu)->oigseukmwsuayccc())->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->megqywqeuquawkim($ummomuiskoeiqaik->kumuygiiqswoyasy(), $mmsmqmyymgwqqweo)->maqiysyuqmwcqoig('!='))->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->owogyemaccuymycq($mgigqqaeseywokym::skgkcgewayieuwsk)->kgyigewyuumysume()->yogqsokgsqemsuoq())->wsacuksekeaemucu(20); if (preg_match_all('/\\d+/', $somkywoaqsaocseu, $meyiiwcswqmuggyg)) { $ygmmaywsqqycaaok = $meyiiwcswqmuggyg[0]; if ($ygmmaywsqqycaaok) { $iyywkasguikswkgy = count($ygmmaywsqqycaaok); $mogcyuaockoeqaqk = []; foreach ($ygmmaywsqqycaaok as $eusockqasqqmoess) { $meayewusoiyawawa = preg_quote($eusockqasqqmoess, '/'); $mogcyuaockoeqaqk[] = "IF({$igkeeiamaoykccmq} REGEXP '(^|[^0-9]){$meayewusoiyawawa}([^0-9]|\$)', 1, 0)"; } $csakyesqgmycgeim = implode(' + ', $mogcyuaockoeqaqk); $ukewoymaumsmmswq->omaeiiwasuqkeeak("({$csakyesqgmycgeim}) / {$iyywkasguikswkgy} as number_score", true); $ukewoymaumsmmswq->mmiqqgoaeccgwoqs($eqwoegegiamegqsm->sqcwsmeosqikckgi('number_score', 1)->kgyigewyuumysume()->maqiysyuqmwcqoig('=')); } } $eeiguyoeakmwswmq = $cqymoigcsuqqwuki->cieaqygkucwoqwke($ukewoymaumsmmswq); if (!empty($eeiguyoeakmwswmq)) { $uoskqyimwccsuakg = $iumiycweoqayuegw->mwyqswsaeeewsosm($icswuaiqeooqqeqc); $gkyciwoiiisgywcs = $this->caokeucsksukesyo()->ywqgcuymeiswqyqc(); foreach ($eeiguyoeakmwswmq as $iemimsskigsgycqm) { $mkegkeiqscgyeqso = $ummomuiskoeiqaik->mwyqswsaeeewsosm($iemimsskigsgycqm); if (!$mgigqqaeseywokym->iekyeyicoyyawomk()->exists($eqwoegegiamegqsm->gwumowwouoisykio([$mgigqqaeseywokym::cscaseoccsekwyms => $mkegkeiqscgyeqso, $mgigqqaeseywokym::yuokwskigygossmk => $uoskqyimwccsuakg]))) { $mgigqqaeseywokym->gssiscqyqsacmeca()->gsegsiocqmsoayii([$mgigqqaeseywokym::skgkcgewayieuwsk => $gkyciwoiiisgywcs->get($iemimsskigsgycqm, 'similarity'), $mgigqqaeseywokym::cscaseoccsekwyms => $mkegkeiqscgyeqso, $mgigqqaeseywokym::yuokwskigygossmk => $uoskqyimwccsuakg], true); } } } } } if (!$this->caokeucsksukesyo()->asgqmkcukouykiie()->iyiccksyewqymmqg($sogksuscggsicmac, $suaemuyiacqyugsm)) { Process::symcgieuakksimmu()->mkisoggamickeicw($mmsmqmyymgwqqweo, $suaemuyiacqyugsm + 1, $goyamqigsmqwymmg); } } } } } public function uosumyqkueiykgiu($tsuauommsquiesmk = null, $ikeuqaskyceuqgmm = null, bool $yyeuiswqwqymcmce = false) : array { $ywmkwiwkosakssii = [Constants::aisguagukaewucii => Constants::ckmqoekmugkggeym, Constants::wkweqssoakmmmguq => [Constants::yyicwqsqaecyqwco, Setting::cgqecaaeyyesqgmq, Setting::ssueywueuqgowsee, Setting::iumakqycmqmikeiq]]; if ($tsuauommsquiesmk) { $ywmkwiwkosakssii[Constants::kyyscqqmsikeuaea] = $tsuauommsquiesmk; $ywmkwiwkosakssii[Constants::wosqwewmqmyweqea] = $ikeuqaskyceuqgmm; } $acqqmqmcquukaqsc = (array) $this->weysguygiseoukqw(Constants::eeeoygaqqmoukaeg, [], $ywmkwiwkosakssii); if ($yyeuiswqwqymcmce) { $kuuggasqumwwqkok = []; foreach ($acqqmqmcquukaqsc as $ekuqiqmikiicgoss) { $qwwuweqkkiikksks = $ekuqiqmikiicgoss[Setting::cgqecaaeyyesqgmq]; if (ContentSegment::yawkygsammoiwywe === $qwwuweqkkiikksks) { $kuuggasqumwwqkok[ContentSegment::yawkygsammoiwywe] = $ekuqiqmikiicgoss; } if (ContentSegment::cqqgeyyqiugckwgw === $qwwuweqkkiikksks) { $kuuggasqumwwqkok[ContentSegment::cqqgeyyqiugckwgw] = $ekuqiqmikiicgoss; } if (count($kuuggasqumwwqkok) === 2) { break; } } $acqqmqmcquukaqsc = $kuuggasqumwwqkok; } return $acqqmqmcquukaqsc; } public function suaeuucwwgumucek(?string $cmwygeyygwqaemaq, bool $ckyskywmqeusaecg = true) : ?string { if ($cmwygeyygwqaemaq) { $cmwygeyygwqaemaq = preg_replace('/[^\\w\\s\\x{0600}-\\x{06FF}]/u', ' ', $cmwygeyygwqaemaq); $cmwygeyygwqaemaq = preg_replace_callback('/[\\x{06F0}-\\x{06F9}\\x{0660}-\\x{0669}]/u', function ($uammqaqiwgcmeska) { $mqwsmsykyouoomgm = mb_ord($uammqaqiwgcmeska[0], 'UTF-8'); if ($mqwsmsykyouoomgm >= 0x6f0 && $mqwsmsykyouoomgm <= 0x6f9) { return $mqwsmsykyouoomgm - 0x6f0; } else { return $mqwsmsykyouoomgm - 0x660; } }, $cmwygeyygwqaemaq); if ($this->caokeucsksukesyo()->cqusmgskowmesgcg()->iqqgmieeqemiowuk('persian-text', Constants::ycaueuokiswkqaoc)) { $cmwygeyygwqaemaq = pr_utility_persian_text_normalize($cmwygeyygwqaemaq); $cmwygeyygwqaemaq = pr_utility_persian_text_remove_stopwords($cmwygeyygwqaemaq, $ckyskywmqeusaecg); } } return $cmwygeyygwqaemaq; } }
